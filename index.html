<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto Dashboard Pro Admin</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background: #1a1a2e; color: #e6e6e6; padding: 20px; }
        .container { max-width: 1400px; margin: 0 auto; }
        
        .admin-panel { background: rgba(0, 173, 181, 0.1); padding: 20px; border-radius: 15px; margin-bottom: 20px; border: 1px solid #00adb5; display: flex; gap: 10px; flex-wrap: wrap; align-items: center; }
        .btn { padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer; color: white; font-weight: bold; transition: 0.3s; text-decoration: none; display: inline-flex; align-items: center; gap: 5px; }
        .btn-add { background: #28a745; }
        .btn-export { background: #007bff; }
        .btn-import { background: #6f42c1; position: relative; }
        .btn-delete { background: #dc3545; padding: 5px 10px; font-size: 0.8rem; }
        .btn-edit { background: #ffc107; color: #1a1a2e; padding: 5px 10px; font-size: 0.8rem; }
        
        input[type="file"] { position: absolute; left: 0; top: 0; opacity: 0; width: 100%; height: 100%; cursor: pointer; }
        
        table { width: 100%; border-collapse: collapse; background: #222831; border-radius: 10px; overflow: hidden; }
        th { background: #393e46; color: #00adb5; padding: 15px; text-align: left; }
        td { padding: 12px 15px; border-bottom: 1px solid #393e46; }
        
        .modal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #222831; padding: 30px; border-radius: 15px; border: 2px solid #00adb5; z-index: 100; min-width: 400px; }
        .modal input { width: 100%; padding: 10px; margin: 10px 0; background: #393e46; border: 1px solid #00adb5; color: white; border-radius: 5px; }
        .overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 90; }
    </style>
</head>
<body>

<div class="container">
    <div class="admin-panel">
        <button class="btn btn-add" onclick="showModal()"><i class="fas fa-plus"></i> Добавить кран</button>
        <button class="btn btn-export" onclick="exportData()"><i class="fas fa-download"></i> Экспорт JSON</button>
        <div class="btn btn-import">
            <i class="fas fa-upload"></i> Импорт JSON
            <input type="file" id="importFile" onchange="importData(event)">
        </div>
        <div style="margin-left: auto;">
            BTC: <span id="btc-live" style="color: #00adb5; font-weight: bold;">Загрузка...</span>
        </div>
    </div>

    <table id="mainTable">
        <thead>
            <tr>
                <th>Название / ID</th>
                <th>Тип</th>
                <th>Награда</th>
                <th>Таймер</th>
                <th>Действия</th>
            </tr>
        </thead>
        <tbody id="table-body"></tbody>
    </table>
</div>

<div class="overlay" id="overlay" onclick="closeModal()"></div>
<div class="modal" id="modal">
    <h2 id="modalTitle">Редактировать проект</h2>
    <input type="hidden" id="edit-id">
    <input type="text" id="edit-name" placeholder="Название">
    <input type="text" id="edit-url" placeholder="Ссылка">
    <input type="number" id="edit-min" placeholder="Минут кулдауна">
    <input type="number" id="edit-reward" step="0.00000001" placeholder="Награда">
    <button class="btn btn-add" style="width: 100%;" onclick="saveProject()">Сохранить</button>
</div>

<script>
    let projects = JSON.parse(localStorage.getItem('my_crypto_data')) || [
        { "sourceId": "f_freebitcoin", "name": "freebitco.in", "url": "https://freebitco.in/?r=galan64", "type": "faucet", "minutes": 60, "reward": 0.00002 },
        { "sourceId": "f_viefaucet", "name": "viefaucet.com", "url": "https://viefaucet.com?r=galan64", "type": "faucet", "minutes": 4, "reward": 0.00001 }
    ];

    function render() {
        const tbody = document.getElementById('table-body');
        tbody.innerHTML = '';
        projects.forEach((p, index) => {
            const row = `<tr>
                <td><b>${escapeHtml(p.name)}</b><br><small>${escapeHtml(p.sourceId || 'id_'+index)}</small></td>
                <td>${escapeHtml(p.type)}</td>
                <td>${(p.reward * 1000000).toFixed(0)} sat</td>
                <td>${p.minutes} min</td>
                <td>
                    <a href="${escapeHtml(p.url)}" target="_blank" class="btn btn-export" style="padding: 5px 8px;"><i class="fas fa-external-link-alt"></i></a>
                    <button class="btn btn-edit" onclick="editProject(${index})"><i class="fas fa-edit"></i></button>
                    <button class="btn btn-delete" onclick="deleteProject(${index})"><i class="fas fa-trash"></i></button>
                </td>
            </tr>`;
            tbody.innerHTML += row;
        });
        localStorage.setItem('my_crypto_data', JSON.stringify(projects));
    }

    function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }

    function deleteProject(index) {
        if(confirm('Удалить этот проект?')) {
            projects.splice(index, 1);
            render();
        }
    }

    function showModal(index = null) {
        document.getElementById('modal').style.display = 'block';
        document.getElementById('overlay').style.display = 'block';
        if(index !== null) {
            const p = projects[index];
            document.getElementById('edit-id').value = index;
            document.getElementById('edit-name').value = p.name;
            document.getElementById('edit-url').value = p.url;
            document.getElementById('edit-min').value = p.minutes;
            document.getElementById('edit-reward').value = p.reward;
        } else {
            document.getElementById('edit-id').value = "";
            document.getElementById('modal').querySelectorAll('input').forEach(i => i.value = "");
        }
    }

    function saveProject() {
        const id = document.getElementById('edit-id').value;
        const newProj = {
            sourceId: "f_custom_" + Date.now(),
            name: document.getElementById('edit-name').value,
            url: document.getElementById('edit-url').value,
            minutes: parseInt(document.getElementById('edit-min').value),
            reward: parseFloat(document.getElementById('edit-reward').value),
            type: "faucet"
        };
        if(id === "") projects.push(newProj);
        else projects[id] = newProj;
        closeModal();
        render();
    }

    function exportData() {
        const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(projects));
        const downloadAnchorNode = document.createElement('a');
        downloadAnchorNode.setAttribute("href", dataStr);
        downloadAnchorNode.setAttribute("download", "crypto_backup.json");
        document.body.appendChild(downloadAnchorNode);
        downloadAnchorNode.click();
        downloadAnchorNode.remove();
    }

    function importData(event) {
        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                projects = JSON.parse(e.target.result);
                render();
            } catch(err) {
                alert("Ошибка чтения файла: " + err.message);
            }
        };
        reader.readAsText(event.target.files[0]);
    }

    function closeModal() {
        document.getElementById('modal').style.display = 'none';
        document.getElementById('overlay').style.display = 'none';
    }

    function editProject(index) { showModal(index); }

    render();
</script>
</body>
</html>
